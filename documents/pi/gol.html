<html>
<body>

<canvas id="back" width="1400" height="650"></canvas>

<script>

var canvas = document.getElementById('back');
var context = canvas.getContext('2d');

var set_back = function(){
	context.beginPath();
	context.rect(0,0,canvas.width,canvas.height);
	context.fillStyle='blue';
	context.fill();
};

set_back();

// I cannot express my hatred for this
Number.prototype.mod = function(n){
	return ((this%n)+n)%n;
}

function Square(x,y,boo){
	this.x = x;
	this.y = y;
	this.boo = boo;
	this.count = 0;
}

Square.prototype.draw = function(){
	if(this.boo)
	{
		context.beginPath();
		context.rect(this.x,this.y,5,5);
		context.fillStyle='black';
		context.fill();
	}
}

function Universe(width,height){
	this.width	= width;
	this.height	= height;
	this.old	= [];
	this.new	= [];
}

Universe.prototype.populate = function(){
	for(var i=0;i<this.width/5;i++)
	{
		this.old[i] = [];
		this.new[i] = [];
		for(var j=0;j<this.height/5;j++)
		{
			this.old[i][j] = new Square(i*5,j*5,Math.floor((100*Math.random()))%2);
			this.new[i][j] = this.old[i][j];
		}
	}
}

Universe.prototype.draw_new = function(){
	for(var i=0;i<this.new.length;i++)
	{
		for(var j=0;j<this.new[i].length;j++)
		{
			this.new[i][j].draw();
		}
	}
}

Universe.prototype.set_new = function(){
	for(var i=0;i<this.new.length;i++)
	{
		for(var j=0;j<this.new[i].length;j++)
		{
			this.new[i][j].count = 0;
		}
	}
	for(var i=0;i<this.old.length;i++)
	{
		for(var j=0;j<this.old[i].length;j++)
		{
			if(this.old[i][j].boo)
			{
				this.new[(i+1).mod(this.new.length)][(j+1).mod(this.new[i].length)].count+=1;
				this.new[(i+1).mod(this.new.length)][(j+0).mod(this.new[i].length)].count+=1;
				this.new[(i+1).mod(this.new.length)][(j-1).mod(this.new[i].length)].count+=1;
				this.new[(i+0).mod(this.new.length)][(j+1).mod(this.new[i].length)].count+=1;
				this.new[(i+0).mod(this.new.length)][(j-1).mod(this.new[i].length)].count+=1;
				this.new[(i-1).mod(this.new.length)][(j+1).mod(this.new[i].length)].count+=1;
				this.new[(i-1).mod(this.new.length)][(j+0).mod(this.new[i].length)].count+=1;
				this.new[(i-1).mod(this.new.length)][(j-1).mod(this.new[i].length)].count+=1;
			}
		}
	}
	for(var i=0;i<this.new.length;i++)
	{
		for(var j=0;j<this.new[i].length;j++)
		{
			if(this.new[i][j].count == 0){this.new[i][j].boo=0;}
			if(this.new[i][j].count == 1){this.new[i][j].boo=0;}
			if(this.new[i][j].count == 2){;}
			if(this.new[i][j].count == 3){this.new[i][j].boo=1;}
			if(this.new[i][j].count == 4){this.new[i][j].boo=0;}
			if(this.new[i][j].count == 5){this.new[i][j].boo=0;}
			if(this.new[i][j].count == 6){this.new[i][j].boo=0;}
			if(this.new[i][j].count == 7){this.new[i][j].boo=0;}
			if(this.new[i][j].count == 8){this.new[i][j].boo=0;}
			this.old[i][j].boo = this.new[i][j].boo;
		}
	}
}

var uni = new Universe(canvas.width,canvas.height);
uni.populate();
uni.draw_new();
var main = function(){
	set_back();
	uni.draw_new();
	uni.set_new();
}

setInterval(main,100);

</script>
</body>
</html>
